# School Landing Page — IIS Edition

A per-user customisable landing page for WA Department of Education schools.
Runs on **Windows Server + IIS + PHP + MySQL** with automatic Windows Authentication
— no LDAP service accounts, no DOE IT tickets required.

---

## Requirements

| Component | Version | Notes |
|-----------|---------|-------|
| Windows Server | 2016 or later | 2019/2022 recommended |
| IIS | 10+ | Built into Windows Server |
| PHP for Windows | 8.2 NTS x64 | https://windows.php.net/download/ |
| MySQL Community | 8.0+ | https://dev.mysql.com/downloads/mysql/ |
| IIS URL Rewrite | 2.1 | https://www.iis.net/downloads/microsoft/url-rewrite (optional but recommended) |

The server must be **domain-joined** for Windows Authentication to work.

---

## Installation (new school)

1. **Download prerequisites** (one-time, save to a USB or network share):
   - PHP 8.2 NTS x64 zip → extract to `C:\PHP`
   - MySQL 8.0 Community installer → run with default options, set a root password
   - IIS URL Rewrite 2.1 MSI → install

2. **Copy this repo** to the server (USB, Git clone, or network share).

3. **Run the install script** from an elevated PowerShell prompt:
   ```powershell
   Set-ExecutionPolicy Bypass -Scope Process -Force
   .\install.ps1
   ```
   The script will:
   - Enable IIS features (Windows Authentication, CGI)
   - Register PHP FastCGI with IIS
   - Create the database, schema, and seed data
   - Copy app files to `C:\inetpub\wwwroot\landing`
   - Generate `config.php` with random DB credentials
   - Create and configure the IIS site

4. **Open the site** in a browser on a domain-joined PC. The setup wizard will
   guide you through school name, theme, and default links.
   Windows login is used automatically — no extra steps.

---

## Re-deploying to another school

1. Copy the repo to the new server
2. Run `install.ps1` — it detects existing installs and skips safely
3. That's it — 5 minutes per school

---

## How authentication works

IIS Windows Authentication uses Kerberos/NTLM via the existing AD trust.
When a domain user opens the page, IIS sets `AUTH_USER` to `DOMAIN\username`
automatically. No passwords are ever sent to the application.

The app strips the domain prefix and uses the bare username as the profile key,
so `EDUCATION\jsmith` and `SCHOOL2\jsmith` are separate profiles.

---

## File structure

```
.
├── app/                    <- Web root (point IIS site here)
│   ├── index.php           <- Main landing page
│   ├── admin/              <- Admin panel (manage links, theme, backgrounds)
│   ├── setup/              <- First-run setup wizard
│   ├── includes/           <- PHP helpers (auth, db, theme, backgrounds)
│   ├── css/                <- Stylesheets
│   ├── js/                 <- JavaScript (clock, schedule, term calculator)
│   ├── uploads/            <- User-uploaded link icons (persisted across updates)
│   └── web.config          <- IIS configuration (Windows Auth, URL rewrite, FastCGI)
├── config.php              <- DB credentials (generated by install.ps1, gitignored)
├── install.ps1             <- One-command deployment script
└── install.sql             <- Database schema + seed data
```

---

## Updating an existing install

```powershell
# Pull latest code, then re-run install.ps1
# It preserves: the database, config.php, and the uploads/ directory
.\install.ps1
```

---

## Term dates

School term dates are hardcoded in `app/js/load_time&weather.js`.
Update them each year — WA DOE publishes dates at:
https://www.education.wa.edu.au/school-term-dates
